<!DOCTYPE html>
<html lang="sw">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Social Tip Hub</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">
  <link rel="stylesheet" href="/css/global.css">
  <%- include('../0-global/google.ejs'); %>
  <%- include('../0-global/fonts.ejs'); %>
  <%- include('../0-global/favicon.ejs') %>
  <style>
    body {
      background: #f7f8fa;
      color: #111;
    }

    .page-title {
      font-weight: 700;
      letter-spacing: -0.5px;
    }

    .card {
      border: 1px solid #e6e8ee;
      box-shadow: 0 6px 20px rgba(17, 34, 68, 0.05);
    }

    .card h5 {
      color: #0d1b2a;
    }

    .badge-tip {
      background: #0d6efd;
      color: #fff;
    }

    .meta {
      color: #6c757d;
    }

    .form-control {
      border-color: #d8dce6;
    }

    .form-control:focus {
      border-color: #0d6efd;
      box-shadow: 0 0 0 0.15rem rgba(13, 110, 253, 0.15);
    }

    .btn-save {
      background: #28a745;
      border: none;
      color: #fff;
      font-weight: 700;
    }
    .btn-save:hover,
    .btn-save:active {
      background: #218838 !important;
      color: #fff !important;
    }

    .empty {
      background: #fff;
      border: 1px dashed #d8dce6;
      padding: 20px;
      border-radius: 12px;
    }

    a.link-light {
      color: #0d6efd;
      text-decoration: none;
    }

    a.link-light:hover {
      text-decoration: underline;
    }

    .card-body {
      padding: 14px;
    }
  </style>
</head>

<body>
  <%- include('../0-global/header.ejs'); %>
  <main class="container my-4 d-flex flex-column">
    <section class="navigation d-flex flex-column justify-content-center align-items-center mb-4">
      <div class="d-flex flex-column flex-md-row align-items-md-center justify-content-between mb-4">
        <div>
          <h2 class="page-title mb-1">Social Tips Score Update</h2>
          <p class="meta mb-0">Pick matches date to update result.</p>
        </div>
        <% if (message) { %>
        <span class="badge bg-success text-dark px-3 py-2">✅ <%= message %></span>
        <% } %>
      </div>

      <form class="mb-3" action="/mkeka/vip/social" method="GET">
        <div class="d-flex flex-wrap align-items-end gap-2">
          <div>
            <label class="form-label mb-1">Select date</label>
            <input type="date" name="date" class="form-control" value="<%= selectedDate || todayNairobi %>" required>
          </div>
          <button type="submit" class="btn btn-save mt-2">Load tips</button>
        </div>
      </form>
    </section>

    <section class="mt-5">
      <div class="mb-3">
        <h4 class="page-title mb-1">Posted matches <%= selectedDate %></h4>
      </div>

      <% if (matches && matches.length) { %>
      <div class="row g-3">
        <% matches.forEach(function(post) { %>
        <div class="col-12 col-md-6">
          <div class="card h-100 <%= post.status === 'won' ? 'border border-success border-3' : '' %>">
            <div class="card-body">
              <div class="d-flex justify-content-between align-items-start">
                <div>
                  <h6 class="mb-1"><%= post.match %></h6>
                  <div class="meta">Tip: <%= post.bet %> · Time: <%= post.time %></div>
                  <div class="meta">Status: <span class="text-uppercase"><%= post.status %></span> · Result: <%= post.result || '-:-' %></div>
                </div>
              </div>
              <form class="mt-3" action="/mkeka/vip/social/<%= post._id %>/result" method="POST" target="_blank">
                <div class="row g-2 align-items-end">
                  <div class="col-sm-6">
                    <label class="form-label mb-1">Result</label>
                    <input type="text" name="result" class="form-control" value="<%= post.result || '' %>" placeholder="eg 2-1" required>
                  </div>
                  <div class="col-sm-4">
                    <label class="form-label mb-1">Status</label>
                    <select name="status" class="form-select" required>
                      <option value="won" <%= post.status === 'won' ? 'selected' : '' %>>Won</option>
                      <option value="lost" <%= post.status === 'lost' ? 'selected' : '' %>>Lost</option>
                    </select>
                  </div>
                  <div class="col-sm-2 d-grid">
                    <button type="submit" class="btn btn-save">Save</button>
                  </div>
                </div>
              </form>
            </div>
          </div>
        </div>
        <% }) %>
      </div>
      <% } else { %>
      <div class="empty text-center">
        <p class="mb-1 fw-semibold">Hakuna social tips zilizowekwa tarehe hii.</p>
        <p class="meta mb-0">Zitaonekana hapa baada ya ku-post kwenye channel.</p>
      </div>
      <% } %>
    </section>
  </main>

  <%- include('../0-global/footer.ejs'); %>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>

</html>
