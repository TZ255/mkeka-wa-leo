<script>
document.addEventListener('DOMContentLoaded', function() {
    const blogPost = document.getElementById('blog-post');
    
    if (!blogPost) return;
    
    // Add copy button to code blocks
    const codeBlocks = blogPost.querySelectorAll('pre code');
    codeBlocks.forEach((codeBlock, index) => {
        const pre = codeBlock.parentElement;
        const copyButton = document.createElement('button');
        copyButton.className = 'copy-code-btn';
        copyButton.innerHTML = '=� Nakili';
        copyButton.title = 'Nakili code';
        
        copyButton.style.cssText = `
            position: absolute;
            top: 10px;
            right: 10px;
            background: #198754;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 4px;
            font-size: 0.8rem;
            cursor: pointer;
            opacity: 0.8;
            transition: opacity 0.3s ease;
        `;
        
        pre.style.position = 'relative';
        
        copyButton.addEventListener('click', function() {
            navigator.clipboard.writeText(codeBlock.textContent).then(function() {
                copyButton.innerHTML = ' Imenakiliwa';
                setTimeout(() => {
                    copyButton.innerHTML = '=� Nakili';
                }, 2000);
            }).catch(function() {
                copyButton.innerHTML = 'L Imeshindwa';
                setTimeout(() => {
                    copyButton.innerHTML = '=� Nakili';
                }, 2000);
            });
        });
        
        copyButton.addEventListener('mouseenter', function() {
            copyButton.style.opacity = '1';
        });
        
        copyButton.addEventListener('mouseleave', function() {
            copyButton.style.opacity = '0.8';
        });
        
        pre.appendChild(copyButton);
    });
    
    // Add smooth scrolling to internal links
    const internalLinks = blogPost.querySelectorAll('a[href^="#"]');
    internalLinks.forEach(link => {
        link.addEventListener('click', function(e) {
            e.preventDefault();
            const targetId = this.getAttribute('href').substring(1);
            const targetElement = document.getElementById(targetId);
            if (targetElement) {
                targetElement.scrollIntoView({ behavior: 'smooth' });
            }
        });
    });
    
    // Add reading progress indicator
    const progressBar = document.createElement('div');
    progressBar.id = 'reading-progress';
    progressBar.style.cssText = `
        position: fixed;
        top: 0;
        left: 0;
        width: 0%;
        height: 3px;
        background: linear-gradient(to right, #198754, #146c43);
        z-index: 1000;
        transition: width 0.1s ease;
    `;
    document.body.appendChild(progressBar);
    
    function updateProgress() {
        const scrollTop = window.pageYOffset;
        const docHeight = document.body.scrollHeight - window.innerHeight;
        const scrollPercent = (scrollTop / docHeight) * 100;
        progressBar.style.width = Math.min(scrollPercent, 100) + '%';
    }
    
    window.addEventListener('scroll', updateProgress);
    
    // Add image zoom functionality
    const images = blogPost.querySelectorAll('img');
    images.forEach(img => {
        img.style.cursor = 'pointer';
        img.addEventListener('click', function() {
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.9);
                z-index: 10000;
                display: flex;
                justify-content: center;
                align-items: center;
                cursor: pointer;
            `;
            
            const modalImg = document.createElement('img');
            modalImg.src = this.src;
            modalImg.alt = this.alt;
            modalImg.style.cssText = `
                max-width: 90%;
                max-height: 90%;
                object-fit: contain;
                border-radius: 8px;
            `;
            
            modal.appendChild(modalImg);
            document.body.appendChild(modal);
            
            modal.addEventListener('click', function() {
                document.body.removeChild(modal);
            });
            
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape') {
                    if (document.body.contains(modal)) {
                        document.body.removeChild(modal);
                    }
                }
            });
        });
    });
    
    // Add smooth scrolling to TOC links (server-side generated)
    const tocLinks = blogPost.querySelectorAll('#table-of-contents a[href^="#"]');
    tocLinks.forEach(link => {
        link.addEventListener('click', function(e) {
            e.preventDefault();
            const targetId = this.getAttribute('href').substring(1);
            const targetElement = document.getElementById(targetId);
            if (targetElement) {
                targetElement.scrollIntoView({ behavior: 'smooth' });
            }
        });
    });
    
    // Add estimated reading time
    const wordCount = blogPost.textContent.split(/\s+/).length;
    const readingTime = Math.ceil(wordCount / 200); // Average 200 words per minute
    
    const readingTimeElement = document.createElement('div');
    readingTimeElement.style.cssText = `
        color: #6c757d;
        font-size: 0.9rem;
        margin-bottom: 2rem;
        padding: 0.5rem 1rem;
        background: #f8f9fa;
        border-radius: 4px;
        border-left: 3px solid #198754;
    `;
    readingTimeElement.innerHTML = `Muda wa kusoma: Dakika ${readingTime}`;
    
    const firstChild = blogPost.firstElementChild;
    if (firstChild) {
        blogPost.insertBefore(readingTimeElement, firstChild);
    }
});
</script>